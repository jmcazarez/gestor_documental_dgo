<div id="clientes" class="page-layout simple fullwidth docs">

  <!-- HEADER -->
  <div class="header p-16 p-sm-24" fxLayout="column" fxLayoutAlign="center center">
    <div class="hero-text content">
      <h1>Historial de versionamiento</h1>
      <h3>Versiones de documentos digitales</h3>
    </div>
  </div>
  <!-- / HEADER -->

  <mat-vertical-stepper [linear]="isLinear" #stepper>
        <mat-step [stepControl]="firstFormGroup">
            <form [formGroup]="firstFormGroup">
                <ng-template matStepLabel>filtrar de busqueda</ng-template>
                <section class="container">
                    <div class="column">
                        <!--  
              <div class="select">
                <p class="tag">Id Documento</p>
                <mat-form-field appearance="fill" class="input">
                  <input matInput placeholder="000">
                </mat-form-field>
              </div>
              -->

                        <div class="select">
                            <p class="tag">Documento</p>
                            <mat-form-field appearance="fill" class="input">
                                <input matInput formControlName="documento" [(ngModel)]="documentoBusqueda"
                                    placeholder="Nombre">
                            </mat-form-field>
                        </div>
                        <div class="select">
                            <p class="tag">Estatus</p>
                            <mat-form-field appearance="fill" class="input">
                                <mat-label>Vigente/No Vigente</mat-label>
                                <mat-select formControlName="vigente" [(ngModel)]="vigenteBusqueda">
                                    <mat-option value="true">Vigente</mat-option>
                                    <mat-option value="false">No Vigente</mat-option>
                                </mat-select>
                            </mat-form-field>
                        </div>
                        <div class="select">
                            <p class="tag">Tipo de Información</p>
                            <mat-form-field appearance="fill" class="input">
                                <mat-label>Seleccionar</mat-label>
                                <mat-select formControlName="informacion" [(ngModel)]="selectedInformacion"
                                    name="informacion">
                                    <mat-option *ngFor="let informacion of arrInformacion"
                                        [value]="informacion.cDescripcionVisibilidad">
                                        {{informacion.cDescripcionVisibilidad}}
                                    </mat-option>
                                </mat-select>
                            </mat-form-field>
                        </div>
                        <div class="select">
                            <p class="tag">Fecha de Creación</p>
                            <mat-form-field appearance="fill" class="input">
                                <mat-label>Seleccione una Fecha</mat-label>
                                <input matInput [matDatepicker]="picker" formControlName="fechaCreacion"
                                    [(ngModel)]="fechaCreacion" [max]="maxDate">
                                <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                                <mat-datepicker #picker></mat-datepicker>
                            </mat-form-field>
                        </div>
                        <div class="select">
                            <p class="tag">Fecha de Carga</p>
                            <mat-form-field appearance="fill" class="input">
                                <mat-label>Seleccione una Fecha</mat-label>
                                <input matInput [matDatepicker]="picker1" formControlName="fechaCarga"
                                    [(ngModel)]="fechaCarga" [max]="maxDate">
                                <mat-datepicker-toggle matSuffix [for]="picker1"></mat-datepicker-toggle>
                                <mat-datepicker #picker1></mat-datepicker>
                            </mat-form-field>
                        </div>
                        <div class="select">
                            <p class="tag">Fecha de ultima Modificación</p>
                            <mat-form-field appearance="fill" class="input">
                                <mat-label>Seleccione una Fecha</mat-label>
                                <input matInput [matDatepicker]="picker2" formControlName="fechaModificacion"
                                    [(ngModel)]="fechaModificacion" [max]="maxDate">
                                <mat-datepicker-toggle matSuffix [for]="picker2"></mat-datepicker-toggle>
                                <mat-datepicker #picker2></mat-datepicker>
                            </mat-form-field>
                        </div>
                        <div class="select">
                            <p class="tag">Tipo de Documento</p>
                            <mat-form-field appearance="fill" class="input">
                                <mat-label>Seleccionar</mat-label>
                                <mat-select formControlName="tipoDocumentos" (change)="changeTipoDocumento($event)"
                                    [(ngModel)]="selectTipoDocumento" name="tipoDocumento">
                                    <mat-option *ngFor="let tipoDocumento of arrTipoDocumentos"
                                        [value]="tipoDocumento.id">
                                        {{tipoDocumento.cDescripcionTipoDocumento}}
                                    </mat-option>
                                </mat-select>
                            </mat-form-field>
                        </div>


                        <!-- He cambiado el de ente por Legislatura, ya que en el caso de uso se requiere legislatura y no ente -->
                        <div class="select">
                            <p class="tag">Legislatura</p>
                            <mat-form-field appearance="fill" class="input">
                                <mat-label>Seleccionar</mat-label>
                                <mat-select formControlName="entes" [(ngModel)]="selectedEntes" name="entes">
                                    <mat-option *ngFor="let ente of arrEntes" [value]="ente.id">
                                        {{ente.cDescripcionEnte}}
                                    </mat-option>
                                </mat-select>
                            </mat-form-field>
                        </div>

                        <!-- <div class="select">
                            <p class="tag">Entidad</p>
                            <mat-form-field appearance="fill" class="input">
                                <mat-label>Seleccionar</mat-label>
                                <mat-select>
                                    <mat-option value="option">Option</mat-option>
                                </mat-select>
                            </mat-form-field>
                        </div>
  -->

                    </div>
                    <div class="column">
                        <!--
                        <div class="select">
                            <p class="tag">Dependencia</p>
                            <mat-form-field appearance="fill" class="input">
                                <mat-label>Seleccionar</mat-label>
                                <mat-select>
                                    <mat-option value="option">Option</mat-option>
                                </mat-select>
                            </mat-form-field>
                        </div>
                       
                        <div class="select">
                            <p class="tag">Legislatura</p>
                            <mat-form-field appearance="fill" class="input">
                                <mat-label>Seleccionar</mat-label>
                                <mat-select>
                                    <mat-option value="option">Option</mat-option>
                                </mat-select>
                            </mat-form-field>
                        </div>
                   
                        <div class="select">
                            <p class="tag">Tipo de Información</p>
                            <mat-form-field appearance="fill" class="input">
                                <mat-label>Seleccionar</mat-label>
                                <mat-select>
                                    <mat-option value="option">Option</mat-option>
                                </mat-select>
                            </mat-form-field>
                        </div>
                    -->
                        <div class="select">
                            <p class="tag">Tipo de Expediente</p>
                            <mat-form-field appearance="fill" class="input">
                                <mat-label>Seleccionar</mat-label>
                                <mat-select formControlName="expediente" [(ngModel)]="selectedExpediente"
                                    name="expediente">
                                    <mat-option *ngFor="let expediente of arrExpediente" [value]="expediente.id">
                                        {{expediente.cDescripcionTipoExpediente}}
                                    </mat-option>
                                </mat-select>
                            </mat-form-field>
                        </div>
                        <div class="select">
                            <p class="tag">Folio de Expediente</p>
                            <mat-form-field appearance="fill" class="input">
                                <input matInput placeholder="Folio" formControlName="folioExpediente"
                                    [(ngModel)]="selectedFolioExpediente">
                            </mat-form-field>
                        </div>
                        <form #formRef="ngForm">
                            <div *ngFor="let meta of arrMetacatalogos; let in=index" class="col-sm-3">
                                <div class="form-group">
                                    <div class="select" *ngIf="arrMetacatalogos[in].cTipoMetacatalogo==='Numérico'">
                                        <p class="tag">{{arrMetacatalogos[in].cDescripcionMetacatalogo}}</p>
                                        <mat-form-field appearance="fill" class="input">
                                            <mat-label>Capture un numero</mat-label>
                                            <input type="number"
                                                *ngIf="arrMetacatalogos[in].cTipoMetacatalogo==='Numérico'" matInput
                                                [(ngModel)]="meta.text"
                                                name="{{arrMetacatalogos[in].cDescripcionMetacatalogo}}">
                                        </mat-form-field>
                                    </div>
                                    <div class="select" *ngIf="arrMetacatalogos[in].cTipoMetacatalogo==='Texto'">
                                        <p class="tag">{{arrMetacatalogos[in].cDescripcionMetacatalogo}}</p>
                                        <mat-form-field appearance="fill" class="input">
                                            <mat-label>Capture un texto</mat-label>
                                            <input *ngIf="arrMetacatalogos[in].cTipoMetacatalogo==='Texto'" matInput
                                                [(ngModel)]="meta.text"
                                                name="{{arrMetacatalogos[in].cDescripcionMetacatalogo}}">
                                        </mat-form-field>
                                    </div>
                                    <div class="select" *ngIf="arrMetacatalogos[in].cTipoMetacatalogo==='Fecha'">
                                        <p class="tag">{{arrMetacatalogos[in].cDescripcionMetacatalogo}}</p>
                                        <mat-form-field appearance="fill" class="input">
                                            <mat-label>Seleccione una Fecha</mat-label>
                                            <input *ngIf="arrMetacatalogos[in].cTipoMetacatalogo==='Fecha'" matInput
                                                [(ngModel)]="meta.text"
                                                name="{{arrMetacatalogos[in].cDescripcionMetacatalogo}}"
                                                [matDatepicker]="picker2" [required]="arrMetacatalogos[in].bOligatorio">
                                            <mat-datepicker-toggle matSuffix [for]="picker2"></mat-datepicker-toggle>
                                            <mat-datepicker #picker2></mat-datepicker>
                                        </mat-form-field>
                                    </div>

                                    <div class="select" *ngIf="arrMetacatalogos[in].cTipoMetacatalogo==='Sí o no'">
                                        <p class="tag">{{arrMetacatalogos[in].cDescripcionMetacatalogo}}</p>
                                        <mat-form-field appearance="fill" class="input">
                                            <mat-label>Si/No</mat-label>
                                            <mat-select [(ngModel)]="meta.text"
                                                name="{{arrMetacatalogos[in].cDescripcionMetacatalogo}}">
                                                <mat-option value="Sí">Sí</mat-option>
                                                <mat-option value="No">No</mat-option>
                                            </mat-select>
                                        </mat-form-field>
                                    </div>

                                </div>
                            </div>

                        </form>

                        <div class="select buttons">
                            <button [disabled]="documentos.length === 0" mat-raised-button matStepperNext color="warn"
                                (click)="filterDatatable()" class="btn-search">Consultar</button>
                            <button [disabled]="documentos.length === 0" mat-raised-button color="warn"
                                class="btn-search" (click)="borrarFiltros()">Borrar</button>
                        </div>
                    </div>
                </section>

            </form>
        </mat-step>
        <mat-step [stepControl]="secondFormGroup">
            <form [formGroup]="secondFormGroup">
                <ng-template matStepLabel>Resultado de busqueda</ng-template>
                <div class="content p-24" align="center" style="border: 1px">
                    <div class="content">
                        <!-- Data table-->

                        <ngx-datatable class="material shadow-none" [rows]="documentos" [loadingIndicator]="loadingIndicator"
                            [columnMode]="'force'" [headerHeight]="50" [footerHeight]="50" [rowHeight]="'auto'"
                            [reorderable]="reorderable" [limit]="10" [scrollbarH]="true" >


                            <ngx-datatable-column name="Id. Documento" prop="id"></ngx-datatable-column>
                            <ngx-datatable-column name="Documento" prop="cNombreDocumento"></ngx-datatable-column>
                            <ngx-datatable-column name="Tipo de Documento" prop="tipoDocumento"></ngx-datatable-column>
                            <ngx-datatable-column name="Tipo de Información" prop="informacion"></ngx-datatable-column>
                            <ngx-datatable-column name="Páginas" prop="paginas" [width]="100"></ngx-datatable-column>
                            <ngx-datatable-column name="Fecha de creación" prop="fechaCreacion"></ngx-datatable-column>

                            <ngx-datatable-column name="Fecha de carga" prop="fechaCarga"></ngx-datatable-column>
                            <ngx-datatable-column name="Fecha de modificación" prop="fechaModificacion">
                            </ngx-datatable-column>
                            <ngx-datatable-column name="Versión" prop="version" [width]="100"></ngx-datatable-column>
                            <ngx-datatable-column name="Clasificación" prop="clasificacion"></ngx-datatable-column>
                            <ngx-datatable-column name="Ente" prop="ente.cDescripcionEnte"></ngx-datatable-column>
                            <ngx-datatable-column name="Tipo de expediente"
                                prop="tipo_de_expediente.cDescripcionTipoExpediente"></ngx-datatable-column>
                            <ngx-datatable-column name="Folio de expediente" prop="folioExpediente">
                            </ngx-datatable-column>
                            <ngx-datatable-column name="Estatus" sortable="false" [width]="100">
                                <ng-template let-row="row" let-value="value" ngx-datatable-cell-template>
                                    <mat-icon *ngIf="row.bActivo" color="accent" class="material-icons">check_circle
                                    </mat-icon>
                                    <mat-icon *ngIf="!row.bActivo" color="warn" class="material-icons">remove_circle
                                    </mat-icon>
                                </ng-template>
                            </ngx-datatable-column>

                            <ngx-datatable-column name="Acciones" sortable="false" prop="id" [width]="100">
                                <ng-template let-row="row" let-value="value" ngx-datatable-cell-template>
                                    
                                    <!-- <a *ngIf="this.optEliminar && row.Eliminar" (click)="eliminarDocumento(row)">
                                        <mat-icon color="warn" class="material-icons pointer"
                                            matTooltip="Clic para eliminar">delete
                                        </mat-icon>
                                    </a>

                                    <a target="_self" *ngIf="row.idDocumento && row.Consultar"
                                        (click)="descargarDocumento(row)">
                                        <mat-icon color="primary" class="material-icons pointer"
                                            matTooltip="Clic para descargar">
                                            cloud_download</mat-icon>

                                    </a>

                                    <a *ngIf="row.Consultar === true && (this.optEditar === false || row.Editar === false)"
                                        (click)="consultarDcumento(row)">
                                        <mat-icon color="primary" class="material-icons pointer"
                                            matTooltip="Clic para editar">remove_red_eye
                                        </mat-icon>
                                    </a> -->

                                    <a *ngIf="row.Consultar === true && this.optEditar === true && row.Editar === true"
                                        (click)="consultarDcumento(row)">
                                        <mat-icon color="primary" class="material-icons pointer"
                                            matTooltip="Clic para editar">remove_red_eye
                                        </mat-icon>
                                    </a>


                                </ng-template>
                            </ngx-datatable-column>

                        </ngx-datatable>
                    </div>
                </div>
                <div class="select buttons">
                    <button mat-raised-button matStepperPrevious color="warn" class="btn-search">Volver</button>
                </div>
                <div class="shadow-none">
                    <table mat-table [dataSource]="dataSource">
                
                        <!-- Position Column -->
                        <ng-container matColumnDef="position">
                            <th mat-header-cell *matHeaderCellDef> No. </th>
                            <td mat-cell *matCellDef="let element"> {{element.position}} </td>
                        </ng-container>
                
                        <!-- Name Column -->
                        <ng-container matColumnDef="name">
                            <th mat-header-cell *matHeaderCellDef> Modificado el </th>
                            <td mat-cell *matCellDef="let element"> 
                                <button mat-button [matMenuTriggerFor]="menu">{{element.name}}</button>
                                <mat-menu #menu="matMenu">
                                    <button mat-menu-item>Ver</button>
                                    <button mat-menu-item>Restaurar</button>
                                    <button mat-menu-item>Eliminar</button>
                                </mat-menu>
                                 </td>
                        </ng-container>
                
                        <!-- Weight Column -->
                        <ng-container matColumnDef="weight">
                            <th mat-header-cell *matHeaderCellDef> modificado por </th>
                            <td mat-cell *matCellDef="let element"> {{element.weight}} </td>
                        </ng-container>
                
                        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
                    </table>
                
                    <mat-paginator [pageSizeOptions]="[5, 10, 20]" showFirstLastButtons></mat-paginator>
                </div>
            </form>
        </mat-step>
    </mat-vertical-stepper>
  

</div>

